# üöÄ Eco-Points System - Render Deployment Guide

This guide will walk you through deploying your Eco-Points System to Render, a modern cloud platform that makes it easy to deploy and scale your applications.

## üìã Prerequisites

- A Render account (free tier available)
- GitHub repository with your Eco-Points System code
- Payment gateway accounts (Stripe, PayPal) for production
- Email service credentials (Gmail, SendGrid, etc.)

## üèóÔ∏è Architecture Overview

Your deployment will consist of 4 main services:

1. **PostgreSQL Database** - User data, submissions, transactions
2. **Redis** - Caching and job queues
3. **Backend API** - NestJS application
4. **Frontend** - Next.js application
5. **MinIO** - S3-compatible object storage

## üöÄ Step-by-Step Deployment

### 1. Connect Your GitHub Repository

1. Go to [render.com](https://render.com) and sign up/login
2. Click "New +" and select "Blueprint"
3. Connect your GitHub account and select your Eco-Points System repository
4. Render will automatically detect the `render.yaml` configuration

### 2. Configure Environment Variables

Before deploying, you'll need to set up these environment variables in Render:

#### Backend Service Environment Variables

```bash
# Database (Auto-configured by Render)
DATABASE_URL=<auto-generated>

# Redis (Auto-configured by Render)
REDIS_URL=<auto-generated>

# JWT Secrets (Auto-generated by Render)
JWT_SECRET=<auto-generated>
JWT_REFRESH_SECRET=<auto-generated>

# S3/MinIO Configuration
S3_ENDPOINT=https://your-minio-service.onrender.com
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin123
S3_BUCKET=eco-points
S3_REGION=us-east-1
S3_FORCE_PATH_STYLE=true

# Payment Gateway Keys (Add your actual keys)
STRIPE_SECRET_KEY=sk_test_your_stripe_key
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_secret

# Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
SMTP_FROM=your-email@gmail.com

# Frontend URL
FRONTEND_URL=https://eco-points-frontend.onrender.com
```

#### Frontend Service Environment Variables

```bash
NODE_ENV=production
NEXT_PUBLIC_API_URL=https://eco-points-backend.onrender.com
NEXT_PUBLIC_APP_URL=https://eco-points-frontend.onrender.com
```

### 3. Deploy Services

#### Option A: Automatic Deployment (Recommended)

1. Render will automatically deploy all services based on `render.yaml`
2. Wait for all services to build and deploy (usually 5-10 minutes)
3. Monitor the deployment logs for any errors

#### Option B: Manual Deployment

If you prefer to deploy services manually:

##### PostgreSQL Database
1. Create new PostgreSQL service
2. Name: `eco-points-db`
3. Database: `eco_points`
4. User: `eco_points_user`
5. Copy the connection string

##### Redis Service
1. Create new Redis service
2. Name: `eco-points-redis`
3. Copy the connection string

##### Backend API
1. Create new Web Service
2. Name: `eco-points-backend`
3. Environment: Node
4. Build Command: `cd backend && npm install && npm run build`
5. Start Command: `cd backend && npm run start:prod`
6. Add all environment variables from step 2

##### Frontend
1. Create new Web Service
2. Name: `eco-points-frontend`
3. Environment: Node
4. Build Command: `cd frontend && npm install && npm run build`
5. Start Command: `cd frontend && npm start`
6. Add environment variables from step 2

##### MinIO Storage
1. Create new Web Service
2. Name: `eco-points-minio`
3. Environment: Docker
4. Dockerfile Path: `./Dockerfile.minio`
5. Add MinIO environment variables

### 4. Database Initialization

After your PostgreSQL service is running:

1. Go to your database service in Render
2. Click "Connect" and copy the connection string
3. Use a database client (pgAdmin, DBeaver, or psql) to connect
4. Run the initialization script from `backend/database/init.sql`

### 5. Verify Deployment

Check that all services are running:

1. **Backend Health Check**: `https://eco-points-backend.onrender.com/health`
2. **API Documentation**: `https://eco-points-backend.onrender.com/api/docs`
3. **Frontend**: `https://eco-points-frontend.onrender.com`
4. **MinIO Console**: `https://eco-points-minio.onrender.com:9001`

## üîß Configuration Details

### Backend Configuration

The backend automatically:
- Connects to Render's PostgreSQL and Redis services
- Generates secure JWT secrets
- Configures CORS for the frontend domain
- Sets up health checks for monitoring

### Frontend Configuration

The frontend automatically:
- Connects to the backend API
- Configures environment-specific settings
- Optimizes for production builds

### MinIO Configuration

MinIO provides:
- S3-compatible API for file storage
- Web console for file management
- Automatic bucket creation
- Secure access controls

## üìä Monitoring & Scaling

### Free Tier Limits

- **PostgreSQL**: 1GB storage, 90 days retention
- **Redis**: 256MB storage
- **Web Services**: 750 hours/month
- **Bandwidth**: 100GB/month

### Scaling Options

When you're ready to scale:

1. **Upgrade to Paid Plans**: More resources and features
2. **Auto-scaling**: Configure based on traffic patterns
3. **Custom Domains**: Add your own domain names
4. **SSL Certificates**: Automatic HTTPS provisioning

## üö® Troubleshooting

### Common Issues

#### Build Failures
- Check build logs for dependency issues
- Verify Node.js version compatibility
- Ensure all environment variables are set

#### Database Connection Issues
- Verify `DATABASE_URL` format
- Check if database service is running
- Ensure database initialization script ran successfully

#### File Upload Issues
- Verify MinIO service is running
- Check S3 configuration in backend
- Ensure bucket permissions are correct

#### CORS Errors
- Verify `FRONTEND_URL` is set correctly
- Check CORS configuration in backend
- Ensure frontend and backend URLs match

### Debug Commands

```bash
# Check backend logs
curl https://eco-points-backend.onrender.com/health

# Check frontend status
curl https://eco-points-frontend.onrender.com

# Test database connection
# Use the connection string from Render dashboard
```

## üîê Security Considerations

### Production Security

1. **Environment Variables**: Never commit secrets to Git
2. **HTTPS**: Render provides automatic SSL certificates
3. **Database**: Use Render's managed PostgreSQL with automatic backups
4. **File Storage**: MinIO provides secure, isolated storage
5. **Rate Limiting**: Backend includes built-in rate limiting

### Payment Security

1. **Stripe**: Use webhook verification
2. **PayPal**: Verify webhook signatures
3. **PCI Compliance**: Payment data never stored locally
4. **Encryption**: All sensitive data encrypted at rest

## üìà Performance Optimization

### Backend Optimization

- Database connection pooling
- Redis caching for frequently accessed data
- BullMQ job queues for background processing
- Automatic health checks and monitoring

### Frontend Optimization

- Next.js production builds
- Static asset optimization
- Lazy loading for components
- Service worker for offline support

## üîÑ Continuous Deployment

### Automatic Updates

1. Connect your GitHub repository
2. Render automatically deploys on push to main branch
3. Zero-downtime deployments
4. Automatic rollback on failures

### Manual Deployments

1. Go to service dashboard
2. Click "Manual Deploy"
3. Select branch or commit
4. Monitor deployment progress

## üìû Support

### Render Support

- [Render Documentation](https://render.com/docs)
- [Community Forum](https://community.render.com)
- [Status Page](https://status.render.com)

### Application Support

- Check application logs in Render dashboard
- Monitor service health and metrics
- Use built-in health check endpoints

## üéâ Next Steps

After successful deployment:

1. **Test All Features**: Upload videos, process submissions, test payments
2. **Configure Monitoring**: Set up alerts for service health
3. **Set Up Domains**: Configure custom domain names
4. **Enable Analytics**: Monitor usage and performance
5. **Plan Scaling**: Prepare for increased traffic

---

**üéØ Your Eco-Points System is now live on Render!**

The system provides a scalable, production-ready platform for video-based environmental rewards. Users can upload videos, earn points, and cash out through secure payment gateways, all while maintaining high performance and security standards.